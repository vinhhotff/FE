(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[125],{5973:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var a=s(7876),r=s(8415);let n=e=>{let{items:t,onAdd:s}=e;return(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:t.map(e=>(0,a.jsxs)("div",{className:"p-4 rounded border shadow hover:shadow-md bg-white flex flex-col justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-1",children:e.name}),(0,a.jsx)("p",{className:"text-gray-600 text-sm mb-2",children:e.description})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"font-bold text-primary",children:["$",e.price]}),(0,a.jsx)("button",{className:"ml-2 px-3 py-1 bg-primary text-white rounded shadow hover:bg-primary/90",onClick:()=>s(e),disabled:!e.isAvailable,children:e.isAvailable?"Add":"Unavailable"})]})]},e._id))})};var l=s(4232);let d=(0,l.createContext)(void 0),i=()=>{let e=(0,l.useContext)(d);if(!e)throw Error("useGuestOrderContext must be used inside GuestOrderProvider");return e},m=e=>{let{children:t}=e,[s,r]=(0,l.useState)(""),[n,i]=(0,l.useState)([]),m=(0,l.useMemo)(()=>n.reduce((e,t)=>e+t.menuItem.price*t.quantity,0),[n]);return(0,a.jsx)(d.Provider,{value:{guestName:s,setGuestName:r,cart:n,addToCart:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;i(s=>{let a=s.findIndex(t=>t.menuItem._id===e._id);if(a>-1){let e=[...s];return e[a].quantity+=t,e}return[...s,{menuItem:e,quantity:t}]})},removeFromCart:e=>i(t=>t.filter(t=>t.menuItem._id!==e)),updateQuantity:(e,t)=>i(s=>s.map(s=>s.menuItem._id===e?{...s,quantity:t}:s)),resetCart:()=>i([]),total:m},children:t})},c=()=>{let{cart:e,total:t,removeFromCart:s,updateQuantity:r}=i();return e.length?(0,a.jsxs)("div",{className:"mt-4 bg-white rounded shadow p-4",children:[(0,a.jsx)("h4",{className:"font-bold mb-2",children:"Your Order"}),e.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between border-b py-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:e.menuItem.name}),(0,a.jsx)("input",{type:"number",min:1,value:e.quantity,className:"mx-2 w-14 text-center border rounded",onChange:t=>r(e.menuItem._id,Number(t.target.value))})," x ",e.menuItem.price]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("strong",{children:["$",e.menuItem.price*e.quantity]}),(0,a.jsx)("button",{onClick:()=>s(e.menuItem._id),className:"ml-2 text-red-500",children:"Remove"})]})]},e.menuItem._id)),(0,a.jsx)("div",{className:"flex justify-end mt-2",children:(0,a.jsxs)("span",{className:"text-lg font-bold",children:["Total: $",t]})})]}):(0,a.jsx)("p",{className:"text-center text-gray-400",children:"Your cart is empty"})};var u=s(4177),o=s(9099),x=s(7914);let h=e=>{let{tableName:t,guestName:s}=e,{data:r,isLoading:n}=function(e,t){return(0,x.I)({queryKey:["guestOrders",e,t],enabled:!!e&&!!t,queryFn:()=>(0,u.WF)({tableName:e,guestName:t}),select:e=>e.data})}(t,s);return s?n?(0,a.jsx)("p",{children:"Loading your orders..."}):r&&r.items.length?(0,a.jsxs)("div",{className:"mt-6 bg-white rounded shadow p-4",children:[(0,a.jsx)("h4",{className:"font-bold mb-2",children:"Your Orders"}),r.items.map(e=>(0,a.jsxs)("div",{className:"mb-3 border-b pb-2",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Status: ",(0,a.jsx)("b",{children:e.status})," | Time: ",new Date(e.createdAt).toLocaleTimeString()]}),(0,a.jsx)("ul",{className:"mt-1",children:e.items.map(e=>(0,a.jsxs)("li",{className:"ml-2 text-gray-900",children:[e.quantity," x ",e.menuItem]},e.menuItem+e._id))}),(0,a.jsxs)("div",{className:"text-right font-bold mt-1",children:["Total: $",e.totalAmount]})]},e._id))]}):(0,a.jsx)("p",{children:"You have no orders yet."}):null},b=e=>{let{tableName:t,guestName:s}=e,{data:r,isLoading:n,refetch:d}=function(e,t){return(0,x.I)({queryKey:["guestPayments",e,t],enabled:!!e&&!!t,queryFn:()=>(0,u.k5)({tableName:e,guestName:t}),select:e=>e.data})}(t,s),[i,m]=(0,l.useState)(!1),[c,o]=(0,l.useState)(!1);async function h(){m(!0);try{await (0,u.Lb)({guestName:s,tableName:t,method:"cash"}),o(!0),d()}catch(e){alert("Payment failed!")}m(!1)}if(!s)return null;if(n)return(0,a.jsx)("p",{children:"Loading your payments..."});let b=r&&r.items.some(e=>"completed"!==e.status),g=r?r.items.filter(e=>"completed"!==e.status).reduce((e,t)=>e+t.amount,0):0;return(0,a.jsxs)("div",{className:"mt-6 bg-white rounded shadow p-4",children:[(0,a.jsx)("h4",{className:"font-bold mb-2",children:"Your Payments (Bills)"}),r&&r.items.map(e=>(0,a.jsxs)("div",{className:"mb-3 border-b pb-2",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Method: ",(0,a.jsx)("b",{children:e.method})," | Time: ",new Date(e.createdAt).toLocaleTimeString()]}),(0,a.jsxs)("div",{className:"text-right font-bold mt-1",children:["Amount: $",e.amount]}),(0,a.jsx)("div",{className:"mt-1 text-right font-medium "+("completed"===e.status?"text-green-700":"text-orange-500"),children:"completed"===e.status?"Paid":"Pending"})]},e._id)),b&&(0,a.jsx)("button",{className:"mt-4 px-6 py-2 rounded bg-green-600 hover:bg-green-700 text-white font-bold w-full",onClick:h,disabled:i,children:i?"Paying...":"Pay Now $".concat(g)}),c&&(0,a.jsx)("div",{className:"text-center text-green-700 font-semibold mt-3",children:"Payment processed! Thank you."})]})};function g(){let{tableName:e}=(0,o.useRouter)().query;return e&&"string"==typeof e?(0,a.jsx)(m,{children:(0,a.jsx)(j,{tableName:e})}):(0,a.jsx)("p",{children:"Loading..."})}function j(e){var t;let{tableName:s}=e,{data:d,isLoading:m}=(0,r.T)(),{cart:o,total:x,guestName:g,setGuestName:j,resetCart:p}=i(),[y,f]=(0,l.useState)(!1),[N,v]=(0,l.useState)(!1),w=async()=>{v(!0);try{await (0,u.fS)({guestName:g,tableName:s,items:o.map(e=>({menuItem:e.menuItem._id,quantity:e.quantity})),totalAmount:x}),f(!0),p()}catch(e){alert("Failed to submit order.")}v(!1)};return m?(0,a.jsx)("p",{children:"Loading menu..."}):(0,a.jsxs)("div",{className:"max-w-5xl mx-auto mt-6 flex flex-col lg:flex-row",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block font-semibold mb-1",children:"Your Name"}),(0,a.jsx)("input",{className:"mb-4 border p-2 rounded w-full",value:g,onChange:e=>j(e.target.value),placeholder:"Enter your name"}),(0,a.jsx)(n,{items:null!=(t=null==d?void 0:d.items)?t:[],onAdd:e=>{}}),g&&(0,a.jsx)(h,{tableName:s,guestName:g}),g&&(0,a.jsx)(b,{tableName:s,guestName:g})]}),(0,a.jsxs)("div",{className:"lg:w-96 lg:ml-8 mt-8 lg:mt-0",children:[(0,a.jsx)(c,{}),(0,a.jsx)("button",{className:"mt-4 w-full py-2 rounded bg-primary text-white text-lg font-bold disabled:bg-gray-300",disabled:!g||!o.length||N,onClick:w,children:N?"Placing Order...":"Place Order"}),y&&(0,a.jsx)("p",{className:"mt-2 text-green-600 font-semibold",children:"Order placed successfully!"})]})]})}},7580:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/guest/table/[tableName]",function(){return s(5973)}])},8415:(e,t,s)=>{"use strict";s.d(t,{T:()=>n});var a=s(7914),r=s(4177);function n(e){return(0,a.I)({queryKey:["menuItems",e],queryFn:()=>(0,r.gL)(e).then(e=>e.data.data)})}},9099:(e,t,s)=>{e.exports=s(4294)}},e=>{e.O(0,[914,636,593,792],()=>e(e.s=7580)),_N_E=e.O()}]);