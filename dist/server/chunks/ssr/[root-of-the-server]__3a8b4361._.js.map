{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ADmin/Desktop/aaaaaa/frontend/src/pages/login.tsx"],"sourcesContent":["import { useState } from 'react';\r\nimport { useRouter } from 'next/router';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport toast from 'react-hot-toast';\r\n\r\n// Safe wrapper function that absolutely prevents AxiosError from escaping\r\nconst safeLogin = async (loginFn: any, credentials: { email: string; password: string }) => {\r\n  try {\r\n    console.log('Safe login wrapper called');\r\n    const result = await loginFn(credentials);\r\n    console.log('Safe login result:', result);\r\n    return result || { success: false };\r\n  } catch (error: any) {\r\n    console.error('Error caught in safe login wrapper:', error);\r\n    \r\n    // Absolutely prevent any error from propagating\r\n    if (error.name === 'AxiosError') {\r\n      console.log('AxiosError intercepted in safe wrapper');\r\n      // Return failure result instead of throwing\r\n      return { success: false };\r\n    }\r\n    \r\n    // For any other error, also return failure\r\n    console.error('Non-Axios error in safe wrapper:', error.name, error.message);\r\n    return { success: false };\r\n  }\r\n};\r\n\r\nexport default function LoginPage() {\r\n  const { login } = useAuth();\r\n  const router = useRouter();\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleSubmit = async (event: React.FormEvent) => {\r\n    event.preventDefault();\r\n    setLoading(true);\r\n    \r\n    // Wrap everything in a try-catch with comprehensive error handling\r\n    try {\r\n      console.log('Login form submitted');\r\n      \r\n      // Call login with additional error protection\r\n      let result;\r\n      try {\r\n        result = await login({ email, password });\r\n        console.log('Login result:', result);\r\n      } catch (loginError: any) {\r\n        console.error('Login call error:', loginError);\r\n        \r\n        // If it's an AxiosError, show appropriate message and return early\r\n        if (loginError.name === 'AxiosError') {\r\n          console.log('AxiosError caught in login page, error should be handled in AuthContext');\r\n          // Don't show additional error toast, AuthContext should handle it\r\n          return;\r\n        }\r\n        \r\n        // For non-Axios errors, show fallback\r\n        toast.error('An unexpected error occurred. Please try again.');\r\n        return;\r\n      }\r\n      \r\n      if (result && result.success && result.role) {\r\n        // Success - redirect based on role\r\n        console.log('Login successful, redirecting to:', result.role);\r\n        switch (result.role) {\r\n          case 'admin':\r\n            router.push('/admin/dashboard');\r\n            break;\r\n          case 'staff':\r\n            router.push('/staff/dashboard');\r\n            break;\r\n          case 'user':\r\n            router.push('/user/home');\r\n            break;\r\n          default:\r\n            toast.error('Unknown role: ' + result.role);\r\n        }\r\n      } else {\r\n        console.log('Login failed, result:', result);\r\n        // If result.success is false, error toast is already shown in AuthContext\r\n      }\r\n    } catch (outerError: any) {\r\n      console.error('Outer error in handleSubmit:', outerError);\r\n      \r\n      // Final fallback - this should never happen\r\n      if (outerError.name !== 'AxiosError') {\r\n        toast.error('An unexpected error occurred. Please try again.');\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex items-center justify-center min-h-screen bg-gray-100\">\r\n      <div className=\"bg-white p-8 rounded-lg shadow-lg max-w-md w-full\">\r\n        <h1 className=\"text-2xl font-bold text-center mb-6\">Login</h1>\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"mb-4\">\r\n            <label htmlFor=\"email\" className=\"block text-sm text-gray-700\">\r\n              Email\r\n            </label>\r\n            <input\r\n              type=\"email\"\r\n              id=\"email\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              className=\"w-full mt-1 px-4 py-2 border rounded-lg shadow-sm focus:ring focus:outline-none focus:border-orange-500\"\r\n              required\r\n            />\r\n          </div>\r\n          <div className=\"mb-6\">\r\n            <label htmlFor=\"password\" className=\"block text-sm text-gray-700\">\r\n              Password\r\n            </label>\r\n            <input\r\n              type=\"password\"\r\n              id=\"password\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n              className=\"w-full mt-1 px-4 py-2 border rounded-lg shadow-sm focus:ring focus:outline-none focus:border-orange-500\"\r\n              required\r\n            />\r\n          </div>\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading}\r\n            className=\"w-full bg-orange-500 text-white py-2 rounded-lg font-semibold hover:bg-orange-600 focus:outline-none focus:ring focus:ring-orange-200 disabled:bg-gray-400\"\r\n          >\r\n            {loading ? 'Logging in...' : 'Login'}\r\n          </button>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}