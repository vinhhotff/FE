(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[125],{3624:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var a=s(7876),r=s(7914),l=s(304);let n=e=>{let{items:t,onAdd:s}=e;return(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:t.map(e=>(0,a.jsxs)("div",{className:"p-4 rounded border shadow hover:shadow-md bg-white flex flex-col justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold mb-1",children:e.name}),(0,a.jsx)("p",{className:"text-gray-600 text-sm mb-2",children:e.description})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"font-bold text-primary",children:["$",e.price]}),(0,a.jsx)("button",{className:"ml-2 px-3 py-1 bg-primary text-white rounded shadow hover:bg-primary/90",onClick:()=>s(e),disabled:!e.isAvailable,children:e.isAvailable?"Add":"Unavailable"})]})]},e._id))})};var d=s(4232);let i=(0,d.createContext)(void 0),m=()=>{let e=(0,d.useContext)(i);if(!e)throw Error("useGuestOrderContext must be used inside GuestOrderProvider");return e},c=e=>{let{children:t}=e,[s,r]=(0,d.useState)(""),[l,n]=(0,d.useState)([]),m=(0,d.useMemo)(()=>l.reduce((e,t)=>e+t.menuItem.price*t.quantity,0),[l]);return(0,a.jsx)(i.Provider,{value:{guestName:s,setGuestName:r,cart:l,addToCart:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;n(s=>{let a=s.findIndex(t=>t.menuItem._id===e._id);if(a>-1){let e=[...s];return e[a].quantity+=t,e}return[...s,{menuItem:e,quantity:t}]})},removeFromCart:e=>n(t=>t.filter(t=>t.menuItem._id!==e)),updateQuantity:(e,t)=>n(s=>s.map(s=>s.menuItem._id===e?{...s,quantity:t}:s)),resetCart:()=>n([]),total:m},children:t})},o=()=>{let{cart:e,total:t,removeFromCart:s,updateQuantity:r}=m();return e.length?(0,a.jsxs)("div",{className:"mt-4 bg-white rounded shadow p-4",children:[(0,a.jsx)("h4",{className:"font-bold mb-2",children:"Your Order"}),e.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between border-b py-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:e.menuItem.name}),(0,a.jsx)("input",{type:"number",min:1,value:e.quantity,className:"mx-2 w-14 text-center border rounded",onChange:t=>r(e.menuItem._id,Number(t.target.value))})," x ",e.menuItem.price]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("strong",{children:["$",e.menuItem.price*e.quantity]}),(0,a.jsx)("button",{onClick:()=>s(e.menuItem._id),className:"ml-2 text-red-500",children:"Remove"})]})]},e.menuItem._id)),(0,a.jsx)("div",{className:"flex justify-end mt-2",children:(0,a.jsxs)("span",{className:"text-lg font-bold",children:["Total: $",t]})})]}):(0,a.jsx)("p",{className:"text-center text-gray-400",children:"Your cart is empty"})};var u=s(9099);let x=e=>{let{tableName:t,guestName:s}=e,{data:n,isLoading:d}=function(e,t){return(0,r.I)({queryKey:["guestOrders",e,t],enabled:!!e&&!!t,queryFn:()=>(0,l.WF)({tableName:e,guestName:t}),select:e=>e.data})}(t,s);return s?d?(0,a.jsx)("p",{children:"Loading your orders..."}):n&&n.items.length?(0,a.jsxs)("div",{className:"mt-6 bg-white rounded shadow p-4",children:[(0,a.jsx)("h4",{className:"font-bold mb-2",children:"Your Orders"}),n.items.map(e=>(0,a.jsxs)("div",{className:"mb-3 border-b pb-2",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Status: ",(0,a.jsx)("b",{children:e.status})," | Time: ",new Date(e.createdAt).toLocaleTimeString()]}),(0,a.jsx)("ul",{className:"mt-1",children:e.items.map(e=>(0,a.jsxs)("li",{className:"ml-2 text-gray-900",children:[e.quantity," x ",e.menuItem]},e.menuItem+e._id))}),(0,a.jsxs)("div",{className:"text-right font-bold mt-1",children:["Total: $",e.totalAmount]})]},e._id))]}):(0,a.jsx)("p",{children:"You have no orders yet."}):null},h=e=>{let{tableName:t,guestName:s}=e,{data:n,isLoading:i,refetch:m}=function(e,t){return(0,r.I)({queryKey:["guestPayments",e,t],enabled:!!e&&!!t,queryFn:()=>(0,l.k5)({tableName:e,guestName:t}),select:e=>e.data})}(t,s),[c,o]=(0,d.useState)(!1),[u,x]=(0,d.useState)(!1);async function h(){o(!0);try{await (0,l.Lb)({guestName:s,tableName:t,method:"cash"}),x(!0),m()}catch(e){alert("Payment failed!")}o(!1)}if(!s)return null;if(i)return(0,a.jsx)("p",{children:"Loading your payments..."});let b=n&&n.items.some(e=>"completed"!==e.status),g=n?n.items.filter(e=>"completed"!==e.status).reduce((e,t)=>e+t.amount,0):0;return(0,a.jsxs)("div",{className:"mt-6 bg-white rounded shadow p-4",children:[(0,a.jsx)("h4",{className:"font-bold mb-2",children:"Your Payments (Bills)"}),n&&n.items.map(e=>(0,a.jsxs)("div",{className:"mb-3 border-b pb-2",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Method: ",(0,a.jsx)("b",{children:e.method})," | Time: ",new Date(e.createdAt).toLocaleTimeString()]}),(0,a.jsxs)("div",{className:"text-right font-bold mt-1",children:["Amount: $",e.amount]}),(0,a.jsx)("div",{className:"mt-1 text-right font-medium "+("completed"===e.status?"text-green-700":"text-orange-500"),children:"completed"===e.status?"Paid":"Pending"})]},e._id)),b&&(0,a.jsx)("button",{className:"mt-4 px-6 py-2 rounded bg-green-600 hover:bg-green-700 text-white font-bold w-full",onClick:h,disabled:c,children:c?"Paying...":"Pay Now $".concat(g)}),u&&(0,a.jsx)("div",{className:"text-center text-green-700 font-semibold mt-3",children:"Payment processed! Thank you."})]})};function b(){let{tableName:e}=(0,u.useRouter)().query;return e&&"string"==typeof e?(0,a.jsx)(c,{children:(0,a.jsx)(g,{tableName:e})}):(0,a.jsx)("p",{children:"Loading..."})}function g(e){var t;let{tableName:s}=e,{data:i,isLoading:c}=(0,r.I)({queryKey:["menuItems"],queryFn:()=>(0,l.gL)({}),select:e=>e.data}),{cart:u,total:b,guestName:g,setGuestName:j,resetCart:p}=m(),[y,f]=(0,d.useState)(!1),[N,v]=(0,d.useState)(!1),w=async()=>{v(!0);try{await (0,l.fS)({guestName:g,tableName:s,items:u.map(e=>({menuItem:e.menuItem._id,quantity:e.quantity})),totalAmount:b}),f(!0),p()}catch(e){alert("Failed to submit order.")}v(!1)};return c?(0,a.jsx)("p",{children:"Loading menu..."}):(0,a.jsxs)("div",{className:"max-w-5xl mx-auto mt-6 flex flex-col lg:flex-row",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block font-semibold mb-1",children:"Your Name"}),(0,a.jsx)("input",{className:"mb-4 border p-2 rounded w-full",value:g,onChange:e=>j(e.target.value),placeholder:"Enter your name"}),(0,a.jsx)(n,{items:null!=(t=null==i?void 0:i.items)?t:[],onAdd:e=>{}}),g&&(0,a.jsx)(x,{tableName:s,guestName:g}),g&&(0,a.jsx)(h,{tableName:s,guestName:g})]}),(0,a.jsxs)("div",{className:"lg:w-96 lg:ml-8 mt-8 lg:mt-0",children:[(0,a.jsx)(o,{}),(0,a.jsx)("button",{className:"mt-4 w-full py-2 rounded bg-primary text-white text-lg font-bold disabled:bg-gray-300",disabled:!g||!u.length||N,onClick:w,children:N?"Placing Order...":"Place Order"}),y&&(0,a.jsx)("p",{className:"mt-2 text-green-600 font-semibold",children:"Order placed successfully!"})]})]})}},7580:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/guest/table/[tableName]",function(){return s(3624)}])},9099:(e,t,s)=>{e.exports=s(4294)}},e=>{e.O(0,[914,636,593,792],()=>e(e.s=7580)),_N_E=e.O()}]);